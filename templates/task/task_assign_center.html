{% extends "layout.html" %}
{% load  admin_tags %}

{% block css  %}
     <style>
        td, th{
        text-align: center;
        vert-align: middle;
        }
     </style>
{%endblock%}

{% block conent %}
     <div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">任务列表</div>
  <div class="panel-body" style="background-color:#f2f2f2">
      <form class="form-inline left"  action="{% url "task_search" %}" method="get">
          <div class="form-group"> <label for="book_sort">类别</label>
                   <select id="book_sort" name="s"   class="form-control">
                       <option value=0>所有</option>
                  {% build_task_type_filter  task_type_id %}
          </select>
          </div>
          <div class="form-group">
              <input type="search" name=_q class="col-md-2 form-control" placeholder="search by username," style="width:250px;display:inline;margin:0 10px;">
          </div>
          <button type="submit" class="btn btn-default">搜索</button>
</form>
      <div class="right">
      <a href="{% url "publish_task" %}"><button  class ="btn btn-primary">添加任务</button></a>
{#          <a href=""><button class="btn btn-info">批量指派</button></a>#}
          <button  onclick="MultiDelete()" class="btn btn-danger">批量删除</button>
      </div>
  </div>
        <!-- Table -->
    <table class="table  table-condensed  table-bordered table-hover table-striped">
      <thead>
      <tr >
          <th><input type="checkbox" onclick="SelectAll(this)"></th>
          <th>ID</th>
          <th>任务名称</th>
          <th>任务描述</th>
          <th>任务类别</th>
          <th>创建人</th>
          <th>指派状态</th>
          <th>创建时间</th>
          <th>截止时间</th>
          <th>操作</th>
      </tr>
      </thead>
      <tbody>
      {% for obj in  query_sets%}
      <tr>
          <td><input type="checkbox"></td>
          <td>{{ obj.tid }}</td>
          <td>{{ obj.title }}</td>
          <td>{{ obj.content|slice:"20"}}</td>
          <td>{% change_to_task_type  obj.type_id  %}</td>
          <td>{% change_to_staff obj.issuer_id %}</td>
{#          <td>{% change_to_task_cycle obj.tcid %}</td>#}
          <td>{% change_to_task_assign_status  obj.is_assign%}</td>
{#          <td>{% change_to_task_status obj.status %} </td>#}
{#          <td>{% change_to_task_finish_status obj.is_finish%}</td>#}
          <td>{{ obj.deadline |date:"Y-m-d "}}</td>
          <td>{{ obj.create_time|date:"Y-m-d H:i" }}</td>
            <td>
                <a href="{% url "task_detail" %}?tid={{ obj.tid }}"  class="btn btn-info">详细</a>
              <a  href="{%url "task_edit" %}?tid={{ obj.tid }}" class="btn btn-primary" >编辑</a>
                <a  href="{%url "task_assign" %}?tid={{ obj.tid }}" class="btn btn-info" >指派</a>

          </td>
      </tr>

      {% endfor %}
      </tbody>
  </table>
    <!-- Modal -->
    <!-- delete-->
<div class="modal fade" id="delete_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">警告！</h4>
      </div>
      <div class="modal-body" style="text-align: center;font-size: 20px;">
        您确定要删除吗？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" id="ensure" class="btn btn-primary">确定</button>
      </div>
    </div>
  </div>
</div>
     </div>


{%endblock %}

{% block js %}
        <script>

    function  SelectAll(ths) {
        //判断是否选中
        ischecked=$(ths).is(":checked");
        //如果选中则全选中,否则取消选中
        $(ths).parent().parent().parent().siblings().find("input:checkbox").prop("checked",ischecked);
    }
//批量删除
    function MultiDelete() {
        $("#delete_modal").modal("show");//显示模态框
        var ids="";
        $("tbody input:checkbox:checked").each(function () {
            id = $(this).parent().next().text();
            if (id){
                id+="|";
                ids+=id;
            }
        });
        $("#ensure").click(function () {
            $("#delete_modal").hide();
              $.ajax({
            url:"{% url "task_delete" %}",
            data:{"ids":ids},
            type:"get",
            dataType:"JSON",
            success:function (arg) {
                if (arg.status){
                   alert("删除成功");
                    window.location.reload()
                }else{
                    alert("删除失败")
                    window.location.reload()


                }
            }
        })
        });
    }
      </script>

{% endblock %}