{% extends "layout.html" %}
{% load admin_tags %}
{% block css %}

      <style>
        td, th{
        text-align: center;
        vert-align: middle;
        }
     </style>
{%endblock %}
{% block conent %}
    <div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">任务列表</div>
  <div class="panel-body" style="background-color:#f2f2f2">
      <div class="right">
      <a href="{% url "performence_edit" %}"><button  class ="btn btn-primary">添加绩效</button></a>
          <button  onclick="MultiDelete()" class="btn btn-danger">批量删除</button>
      </div>
  </div>
    </div>

      <!-- Table -->
    <table class="table  table-condensed  table-bordered table-hover table-striped">
      <thead>
      <tr >
          <th><input type="checkbox" onclick="SelectAll(this)"></th>
          <th>ID</th>
          <th>绩效名称</th>
          <th>个人分值</th>
          <th>个人总分</th>
          <th>团队分值</th>
          <th>团队总分</th>
          <th>操作</th>
      </tr>
      </thead>
      <tbody>
      {% for obj in query_sets %}
      <tr>
          <td><input type="checkbox"></td>
          <td>{{ obj.pid }}</td>
          <td>{{ obj.name }}</td>
          <td>{{ obj.personal_score}}</td>
          <td>{{ obj.personal_total}}</td>
          <td>{{ obj.team_score}}</td>
          <td>{{ obj.team_total}}</td>
            <td>
              <a  href="{%url "performence_edit" %}?pid={{ obj.pid }}" class="btn btn-primary" >编辑</a>
          </td>
      </tr>
      {% endfor %}
      </tbody>
  </table>
    <!-- Modal -->
    <!-- delete-->
<div class="modal fade" id="delete_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">警告！</h4>
      </div>
      <div class="modal-body" style="text-align: center;font-size: 20px;">
        您确定要删除吗？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" id="ensure" class="btn btn-primary">确定</button>
      </div>
    </div>
  </div>
</div>
    </div>


{% endblock %}
{% block js%}
    <script>
      function  SelectAll(ths) {
        //判断是否选中
        ischecked=$(ths).is(":checked");
        //如果选中则全选中,否则取消选中
        $(ths).parent().parent().parent().siblings().find("input:checkbox").prop("checked",ischecked);
    }
//批量删除
    function MultiDelete() {
        $("#delete_modal").modal("show");//显示模态框
        var ids="";
        $("tbody input:checkbox:checked").each(function () {
            id = $(this).parent().next().text();
            if (id){
                id+="|";
                ids+=id;
            }
        });
        $("#ensure").click(function () {
            $("#delete_modal").hide();
              $.ajax({
            url:"{% url "performence_delete" %}",
            data:{"ids":ids},
            type:"get",
            dataType:"JSON",
            success:function (arg) {
                if (arg.status){
                   alert("删除成功");
                    window.location.reload()
                }else{
                    alert(arg.message)
                    window.location.reload()
                }
            }
        })
        });
    }
    </script>
{% endblock %}