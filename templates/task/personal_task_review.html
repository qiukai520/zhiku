{% extends "layout.html" %}
{% load  admin_tags %}

{% block css  %}
     <style>
        td, th{
            text-align: left;
            vert-align: middle;
            padding: 10px 18px !important;
        }
        .form-horizontal .control-label {
            padding-top: 7px;
            margin-bottom: 0;
            text-align: right;
        }

      .select-box{
          top:5px;
          height: 200px !important;
          width: 100%;
        border-radius: 3px;
      }
       span.glyphicon.glyphicon-arrow-left, span.glyphicon.glyphicon-arrow-right {
        position: absolute;
        right: -8px;
        text-align: center;
        margin-top: 80px;
        color: blue;
    }
    span.glyphicon.glyphicon-arrow-right {
        margin-top:120px;
    }
    ul{
        padding:0px;
    }
       ul>li{
       cursor: pointer;
       padding:0;margin:0;list-style:none
  }


       .member_name{
           color:blue;

     }
       .member_name:hover{
          color:red;
       }
     button,.btn{
        margin: 0px !important;
    }
     a:link {
         color: red
     }
     </style>
{%endblock%}

{% block conent %}
     <div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">我的审核任务</div>
  <div class="panel-body" style="background-color:#f2f2f2">
      <form class="form-inline left"  action="{% url "personal_task_review" %}" method="get">
          <div class="form-group"> <label for="task_sort">任务类别</label>
                   <select id="task_sort" name="s"   class="form-control">
                       <option value=0>所有</option>
                  {% build_task_type_filter filter %}
          </select>
          </div>
          <button type="submit" class="btn btn-default">搜索</button>
</form>
      <div style="float:right; ">
          <button  onclick="MultiDelete()" class="btn btn-danger">批量删除</button>
      </div>
  </div>
        <!-- Table -->
    <table id="table_local" class="table datatable table-striped table-hover table-striped">
       <thead>
      <tr >
          <th><input type="checkbox" onclick="SelectAll(this)"></th>
          <th>ID</th>
          <th>任务名称</th>
          <th>任务描述</th>
          <th>任务类别</th>
          <th>指派人</th>
          <th>开始时间</th>
          <th>截止时间</th>
          <th>审核对象</th>
      </tr>
       </thead>
      <tbody>
      {% if query_sets %}
           {% for obj in  query_sets%}
      <tr>
          <td><input type="checkbox"></td>
          <td>{{ obj.tid }}</td>
          <td>{{ obj.title }}</td>
          <td>{{ obj.content|slice:"15"}}</td>
          <td>{% change_to_task_type  obj.type_id  %}</td>
          <td>{% change_to_staff obj.issuer_id %}</td>
          <td>{{ obj.deadline |date:"Y-m-d "}}</td>
          <td>{{ obj.create_time|date:"Y-m-d H:i" }}</td>
          <td>{% bulid_person_review_list 1 obj.tid %}
          </td>
      </tr>
      {% endfor %}
      {% endif %}
      </tbody>
  </table>
 </div>
    <!-- Modal -->
    <!-- delete-->
<div class="modal fade" id="delete_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">警告！</h4>
      </div>
      <div class="modal-body" style="text-align: center;font-size: 20px;">
        您确定要删除吗？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button"  id="ensure"  class="btn btn-primary">确定</button>
      </div>
    </div>
  </div>
</div>

{%endblock %}

{% block js %}

        <script src="https://cdn.bootcss.com/moment.js/2.22.1/moment.min.js"></script>
        <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.45/js/bootstrap-datetimepicker.min.js"></script>
        <script src="/static/js/jquery.cookie.js"></script>
        <script>
        //预防csrf
            var csrftoken = $.cookie('csrftoken');
        function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

      /*
    自执行函数
    */
    $(function () {
         //初始化datatables 改成中文显示
       $('#table_local').dataTable({
           bDestroy: true,
           autoWidth:false,////不开启自动宽度，用bootstrap的自适应去调整
           "lengthMenu":[10,20,30, 40,50],//表格行数选择框内数目 显示2条,4条,20条,50条
           "displayLength": 10,//默认的显示行数 (也就是每页显示几条数据)
           "language": {//自定义语言提示
                "processing": "处理中...",
                "lengthMenu": "显示 _MENU_ 项结果",
                "zeroRecords": "没有找到相应的结果",
                "info": "第 _START_ 至 _END_ 行，共 _TOTAL_ 行",
                "infoEmpty": "第 0 至 0 项结果，共 0 项",
                "infoFiltered": "(由 _MAX_ 项结果过滤)",
                "infoPostFix": "",
                "search": "搜索:",
                "searchPlaceholder": "请输入要搜索内容...",
                "url": "",
                "thousands": "'",
                "emptyTable": "表中数据为空",
                "loadingRecords": "载入中...",
                "infoThousands": ",",
                "paginate": {
                    "first": "首页",
                    "previous": "上页",
                    "next": "下页",
                    "last": "末页"
                }
            }
	});
    });
    //字符串格式化
String.prototype.format=function()
{
  if(arguments.length==0) return this;
  for(var s=this, i=0; i<arguments.length; i++)
    s=s.replace(new RegExp("\\{"+i+"\\}","g"), arguments[i]);
  return s;
};


    function  SelectAll(ths) {
        //判断是否选中
        ischecked=$(ths).is(":checked");
        //如果选中则全选中,否则取消选中
        $(ths).parent().parent().parent().siblings().find("input:checkbox").prop("checked",ischecked);
    }
//批量删除
    function MultiDelete() {
        $("#delete_modal").modal("show");//显示模态框
        var ids="";
        $("tbody input:checkbox:checked").each(function () {
            id = $(this).parent().next().text();
            if (id){
                id+="|";
                ids+=id;
            }
        });
        $("#ensure").click(function () {
            $("#delete_modal").hide();
              $.ajax({
            url:"{% url "task_delete" %}",
            data:{"ids":ids},
            type:"get",
            dataType:"JSON",
            success:function (arg) {
                if (arg.status){
                   alert("删除成功");
                    window.location.reload()
                }else{
                    alert("删除失败"),
                    window.location.reload()


                }
            }
        })
        });
    }

      </script>
{% endblock %}